
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Predict the Prompt — Thought Playback</title>
<link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a12;
    --card: #0f0f1a;
    --text: #e6e6f0;
    --muted: #a1a1b5;
    --accent: #ff2bd7;  /* neon magenta */
    --accent2: #00eaff; /* neon cyan */
    --border: #2a2a3f;
    --thought: #14142a;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    color: var(--text);
    background: radial-gradient(80vw 80vh at 70% -20%, #121223 0, var(--bg) 60%);
  }
  .wrap { max-width: 1000px; margin: 24px auto 80px; padding: 16px; }
  
  .masthead {
    font-family: "UnifrakturCook", serif;
    text-align: center;
    font-size: clamp(28px, 5vw, 54px);
    line-height: 1.05;
    letter-spacing: .5px;
    margin: 8px 0 2px;
    color: var(--accent2);
    text-shadow: 0 0 8px rgba(0,234,255,.7), 0 0 18px rgba(0,234,255,.5), 0 0 30px rgba(0,234,255,.4);
  }

  .mast-sub { text-align: center; color: var(--muted); font-size: 13px; margin-bottom: 10px; }
  header { display:flex; flex-direction: column; align-items:center; gap: 10px; margin-bottom: 10px; }
  
  h1 {
    margin:0;
    font-size: clamp(22px, 3vw, 32px);
    letter-spacing: .3px;
    color: var(--accent);
    text-shadow: 0 0 8px rgba(255,43,215,.75), 0 0 18px rgba(255,43,215,.45);
  }

  .row { display:flex; align-items:center; gap:12px; flex-wrap:wrap; justify-content:center; }
  .slider { display:flex; gap:12px; align-items:center; }
  .score { font-size:14px; color: var(--muted); }
  .pill {
    padding:6px 10px; border-radius:999px; background:#151536; color:var(--accent2);
    font-size:12px; font-weight:800; border:1px solid var(--border);
  }
  .card {
    background: linear-gradient(180deg, rgba(17,17,30,0.9), rgba(10,10,18,0.95));
    border: 1px solid var(--border);
    border-radius: 14px;
    box-shadow: 0 15px 50px rgba(0,0,0,.6), 0 0 30px rgba(0,234,255,.05);
    padding: clamp(16px, 2.5vw, 24px);
    width: 100%;
  }
  .prompt { font-size: clamp(18px, 2.4vw, 24px); margin: 6px 0 10px; letter-spacing: .2px; }
  .subtitle { color: var(--muted); margin: 6px 0 14px; }
  .choices { display: grid; grid-template-columns: 1fr; gap: 10px; margin: 12px 0 18px; }
  .choice {
    display:flex; align-items:center; justify-content:space-between;
    padding: 12px 14px; border-radius: 10px; border: 1px solid var(--border);
    background: #111125; cursor:pointer; user-select:none;
    transition: transform .05s ease, border-color .12s ease, box-shadow .12s ease;
  }
  .choice:hover { transform: translateY(-1px); box-shadow: 0 0 12px rgba(0,234,255,.12); }
  .choice.selected { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(255,43,215,.25), inset 0 0 18px rgba(255,43,215,.08); }

  .btn {
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    color:#0a0a12; border:0; padding: 12px 16px; border-radius: 10px; font-weight:800; cursor:pointer;
    text-transform: uppercase; letter-spacing:.3px;
    box-shadow: 0 8px 25px rgba(255,43,215,.25), 0 6px 20px rgba(0,234,255,.18);
  }
  .btn.secondary { background:#13132a; color:var(--text); border:1px solid var(--border); box-shadow:none; text-transform:none; }
  .btn:disabled { opacity:.6; cursor:not-allowed; }

  .panel { margin-top: 16px; border-top: 1px dashed var(--border); padding-top: 16px; }
  .bars { display:grid; grid-template-columns:1fr; gap:8px; margin-top:8px; }
  .bar { height: 30px; background:#0e0e20; border:1px solid var(--border); border-radius:8px; overflow:hidden; position:relative; }
  .bar > div { height:100%; width:0%; background: linear-gradient(90deg, rgba(255,43,215,.7), rgba(0,234,255,.7)); transition: width .6s ease; }
  .bar label { position:absolute; left:10px; top:50%; transform: translateY(-50%); font-weight:700; color:#e9f7ff; text-shadow: 0 0 6px rgba(0,234,255,.4); }

  /* Thought Playback */
  .timeline {
    display:grid; grid-template-columns: 1fr; gap:10px; margin-top: 10px;
  }
  .step {
    background: var(--thought);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 10px 12px;
    display:flex; gap:12px; align-items:flex-start;
    position: relative;
  }
  .step:before {
    content: attr(data-step);
    font-weight: 800;
    color: var(--accent2);
    padding: 2px 8px;
    border: 1px solid var(--border);
    border-radius: 999px;
    font-size: 12px;
  }
  .dots {
    margin-left: auto;
    display:flex; gap:6px; align-items:center;
  }
  .dot {
    width: 8px; height: 8px; border-radius: 50%; background: var(--accent2);
    opacity: .2; animation: blink 1.2s infinite ease-in-out;
  }
  .dot:nth-child(2){ animation-delay:.2s;}
  .dot:nth-child(3){ animation-delay:.4s;}
  @keyframes blink {
    0%, 100% { opacity:.2; transform: translateY(0); }
    50% { opacity:1; transform: translateY(-2px); }
  }
  .step.done .dot { opacity:.15; animation: none; }
  .step.done:after {
    content: "✔";
    position:absolute; right:10px; top:8px; color: var(--accent); font-weight: 800;
  }

  .thought-bubbles { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  .bubble {
    background:#121233; border:1px solid var(--border); border-radius: 999px; padding:6px 10px; font-size: 12px;
    box-shadow: 0 0 8px rgba(0,234,255,.08);
  }

  input[type=range] {
    -webkit-appearance: none;
    width: 120px;
    height: 6px;
    border-radius: 5px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    outline: none;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
    border: 2px solid var(--accent2);
  }
  input[type=range]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
    border: 2px solid var(--accent2);
  }

  input[type=range] {
    box-shadow: 0 0 10px rgba(255,43,215,0.6), 0 0 20px rgba(0,234,255,0.5);
  }
  input[type=range]::-webkit-slider-thumb {
    box-shadow: 0 0 8px rgba(0,234,255,0.9), 0 0 14px rgba(255,43,215,0.9);
  }
  input[type=range]::-moz-range-thumb {
    box-shadow: 0 0 8px rgba(0,234,255,0.9), 0 0 14px rgba(255,43,215,0.9);
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="masthead">The Transformer Times</div>
    <div class="mast-sub">A mini-newspaper of AI games & demos</div>

    <header>
      <h1>Predict the Prompt <span class="pill">+ Thought Playback</span></h1>
      <div class="row">
        <div class="slider">
          <label for="temp"><strong>Randomness</strong></label>
          <input id="temp" type="range" min="0" max="2" step="0.1" value="0.9">
          <span id="tempVal">0.9</span>
        </div>
        <div class="slider">
          <label for="weird"><strong>Weirdness</strong></label>
          <input id="weird" type="range" min="0" max="1" step="0.05" value="0.25">
          <span id="weirdVal">0.25</span>
        </div>
        <div class="score">Score: <span id="score">0</span></div>
      </div>
    </header>

    <div class="card">
      <div class="subtitle">Round <span id="round">1</span> of <span id="total">15</span></div>
      <div id="prompt" class="prompt">Loading…</div>

      <div id="choices" class="choices"></div>

      <div class="row">
        <button id="submit" class="btn" disabled>Lock In</button>
        <button id="next" class="btn" style="display:none;">Next</button>
      </div>

      <div id="reveal" class="panel" style="display:none;">
        <div id="outcome" class="subtitle"></div>
        <div class="timeline" id="timeline">
          <!-- Steps injected here -->
        </div>
        <div class="bars" id="bars"></div>
      </div>
    </div>

    <div class="panel" style="margin-top:16px;">
      <div class="subtitle"><b>What you're seeing:</b></div>
      <ul style="margin:8px 0 0 18px; color:var(--muted); line-height:1.65;">
        <li><b>Step 1 — Read:</b> Model reads the sentence and turns it into numbers.</li>
        <li><b>Step 2 — Score:</b> It gives each possible next word a score.</li>
        <li><b>Step 3 — Pick:</b> With Randomness & Weirdness, it picks one word.</li>
      </ul>
    </div>
  </div>

<script>
const rounds = [
  { prompt: "The cat sat on the", options: ["mat", "roof", "keyboard", "explosion"], base:[0.72,0.12,0.10,0.06], continuation:"The cat sat on the <b>mat</b> and purred." },
  { prompt: "For breakfast, I usually drink a cup of", options: ["coffee","juice","marbles","water"], base:[0.42,0.28,0.02,0.28], continuation:"For breakfast, I usually drink a cup of <b>juice</b> or <b>water</b>." },
  { prompt: "In winter, the roads can be", options: ["icy","bouncy","invisible","noisy"], base:[0.64,0.06,0.06,0.24], continuation:"In winter, the roads can be <b>icy</b>." },
  { prompt: "The capital of France is", options: ["Paris","Lyon","Berlin","Croissant"], base:[0.80,0.10,0.08,0.02], continuation:"The capital of France is <b>Paris</b>." },
  { prompt: "She saved her work by pressing", options:["Ctrl+S","Delete","Spacebar","Alt+Tab"], base:[0.60,0.12,0.10,0.18], continuation:"She saved her work by pressing <b>Ctrl+S</b>." },
  { prompt: "On a clear night, you can see the", options:["stars","internet","microwave","taxes"], base:[0.66,0.04,0.06,0.24], continuation:"On a clear night, you can see the <b>stars</b>." },
  { prompt: "A common pet is a", options:["dog","iguana","rock","spaceship"], base:[0.62,0.18,0.06,0.14], continuation:"A common pet is a <b>dog</b>." },
  { prompt: "When it rains, I carry a", options:["umbrella","cactus","saxophone","ladder"], base:[0.73,0.05,0.09,0.13], continuation:"When it rains, I carry an <b>umbrella</b>." },
  { prompt: "To boil water faster, put a lid on the", options:["pot","floor","window","book"], base:[0.69,0.06,0.15,0.10], continuation:"To boil water faster, put a lid on the <b>pot</b>." },
  { prompt: "The opposite of hot is", options:["cold","warm","spicy","north"], base:[0.76,0.12,0.09,0.03], continuation:"The opposite of hot is <b>cold</b>." },
  { prompt: "Birds build their", options:["nests","invoices","apps","sandwiches"], base:[0.67,0.05,0.12,0.16], continuation:"Birds build their <b>nests</b>." },
  { prompt: "My phone ran out of", options:["battery","sand","gravity","fame"], base:[0.71,0.06,0.08,0.15], continuation:"My phone ran out of <b>battery</b>." },
  { prompt: "The fastest land animal is the", options:["cheetah","snail","ostrich","meme"], base:[0.76,0.03,0.18,0.03], continuation:"The fastest land animal is the <b>cheetah</b>." },
  { prompt: "A baker puts bread in the", options:["oven","freezer","pocket","attic"], base:[0.74,0.09,0.06,0.11], continuation:"A baker puts bread in the <b>oven</b>." },
  { prompt: "At night we see the", options:["moon","algorithm","receipt","ceiling"], base:[0.63,0.07,0.11,0.19], continuation:"At night we see the <b>moon</b>." }
];

let order = [...Array(rounds.length).keys()];
let currIndex = 0;
let score = 0;
const totalRounds = rounds.length;
document.getElementById('total').textContent = totalRounds;

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function addWeirdness(base, weird) {
  const n = base.length;
  const uniform = 1.0 / n;
  const noisy = base.map(p => (1 - weird) * p + weird * uniform);
  const jitter = noisy.map(p => Math.max(1e-9, p + (Math.random() - 0.5) * weird * 0.1));
  const sum = jitter.reduce((a,b)=>a+b,0);
  return jitter.map(p => p / sum);
}
function softmaxWithTemp(base, temp) {
  const eps = 1e-12;
  const logp = base.map(p => Math.log(p + eps));
  const scaled = logp.map(v => v / Math.max(temp, 0.0001));
  const maxv = Math.max(...scaled);
  const exps = scaled.map(v => Math.exp(v - maxv));
  const sum = exps.reduce((a,b)=>a+b,0);
  return exps.map(e => e / sum);
}

function renderRound() {
  const i = order[currIndex];
  const r = rounds[i];
  document.getElementById('round').textContent = currIndex + 1;
  document.getElementById('prompt').innerHTML = r.prompt + " …";

  const temp = parseFloat(document.getElementById('temp').value);
  const weird = parseFloat(document.getElementById('weird').value);

  const isWild = ((currIndex + 1) % 4 === 0);
  const appliedWeird = isWild ? Math.min(1, weird + 0.4) : weird;

  const noisy = addWeirdness(r.base, appliedWeird);
  const probs = softmaxWithTemp(noisy, temp);

  r.currProbs = probs;
  r.isWild = isWild;

  const choicesEl = document.getElementById('choices');
  choicesEl.innerHTML = "";
  document.getElementById('reveal').style.display = 'none';
  document.getElementById('submit').disabled = true;
  document.getElementById('next').style.display = 'none';

  r.options.forEach((opt, j) => {
    const label = document.createElement('label');
    label.className = 'choice';
    label.innerHTML = `<span>${opt}</span><span style="font-size:12px;color:${'var(--muted)'};">tap to choose</span>`;
    const input = document.createElement('input');
    input.type = 'radio';
    input.name = 'opt';
    input.value = j;
    label.prepend(input);
    label.addEventListener('click', ()=>{
      document.querySelectorAll('.choice').forEach(c=>c.classList.remove('selected'));
      label.classList.add('selected');
      document.getElementById('submit').disabled = false;
    });
    choicesEl.appendChild(label);
  });
}

function playbackSteps(tokens, probs, selectedIdx, doneCb) {
  const timeline = document.getElementById('timeline');
  timeline.innerHTML = '';

  // Step 1
  const s1 = document.createElement('div');
  s1.className = 'step';
  s1.setAttribute('data-step', '1  Read');
  s1.innerHTML = `<div>Model reads the sentence and turns it into numbers.</div>
    <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  timeline.appendChild(s1);

  // Step 2
  const s2 = document.createElement('div');
  s2.className = 'step';
  s2.setAttribute('data-step', '2  Score');
  const top3 = tokens.map((t,i)=>({t, p: probs[i]})).sort((a,b)=>b.p-a.p).slice(0,3);
  s2.innerHTML = `<div>The model scores each next word. Top ideas:</div>`;
  const bubbles = document.createElement('div'); bubbles.className='thought-bubbles';
  top3.forEach(({t,p})=>{
    const b = document.createElement('div'); b.className='bubble'; b.textContent = `${t} (${(p*100).toFixed(0)}%)`; bubbles.appendChild(b);
  });
  s2.appendChild(bubbles);
  s2.innerHTML += `<div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  timeline.appendChild(s2);

  // Step 3
  const s3 = document.createElement('div');
  s3.className = 'step';
  s3.setAttribute('data-step', '3  Pick');
  s3.innerHTML = `<div>With Randomness & Weirdness, it picks one word.</div>
    <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  timeline.appendChild(s3);

  // Animate steps
  setTimeout(()=>{ s1.classList.add('done'); }, 700);
  setTimeout(()=>{ s2.classList.add('done'); }, 1500);
  setTimeout(()=>{ s3.classList.add('done'); doneCb && doneCb(); }, 2300);
}

function reveal(selectedIdx) {
  const i = order[currIndex];
  const r = rounds[i];
  const probs = r.currProbs;
  const bestIdx = probs.indexOf(Math.max(...probs));
  const correct = selectedIdx === bestIdx;
  const gained = Math.round(100 * probs[selectedIdx]);
  const wildBonus = r.isWild ? 1.2 : 1.0;
  score += (correct ? Math.max(gained, 50) : Math.max(5, Math.round(gained*0.4))) * wildBonus;

  document.getElementById('score').textContent = Math.round(score);
  document.getElementById('reveal').style.display = 'block';

  const outcome = document.getElementById('outcome');
  outcome.innerHTML = correct
    ? `✅ You guessed it! That was the top word.`
    : `🤖 Almost! The top word was <b>${r.options[bestIdx]}</b>.`;

  // Thought Playback first, then draw bars
  playbackSteps(r.options, probs, selectedIdx, () => {
    const bars = document.getElementById('bars');
    bars.innerHTML = "";
    r.options
      .map((name, j)=>({name, p: probs[j]}))
      .sort((a,b)=>b.p - a.p)
      .forEach(({name, p})=>{
        const row = document.createElement('div');
        row.className = 'bar';
        row.innerHTML = `<label>${name} — ${(p*100).toFixed(0)}%</label><div></div>`;
        bars.appendChild(row);
        setTimeout(()=>{ row.querySelector('div').style.width = `${(p*100).toFixed(0)}%`; }, 100);
      });
    document.getElementById('next').style.display = 'inline-block';
  });
}

document.getElementById('submit').addEventListener('click', ()=>{
  const checked = document.querySelector('input[name="opt"]:checked');
  if (!checked) return;
  reveal(parseInt(checked.value, 10));
  document.getElementById('submit').disabled = true;
});
document.getElementById('next').addEventListener('click', ()=>{
  currIndex = (currIndex + 1) % order.length;
  renderRound();
});

const tempInput = document.getElementById('temp');
const tempVal = document.getElementById('tempVal');
tempInput.addEventListener('input', ()=>{
  tempVal.textContent = tempInput.value;
  renderRound();
});
const weirdInput = document.getElementById('weird');
const weirdVal = document.getElementById('weirdVal');
weirdInput.addEventListener('input', ()=>{
  weirdVal.textContent = weirdInput.value;
  renderRound();
});

order = shuffle(order);
document.getElementById('total').textContent = rounds.length;
renderRound();
</script>
</body>
</html>
